# https://github.com/NobbZ/nixos-config/blob/main/.github/workflows/flake-update.yml

name: "flake-update"

on:
  workflow_dispatch:
  # TODO
  # schedule:
  # - cron: '00 02 1 * *'

jobs:
  bump_lock:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: cachix/install-nix-action@v17
      with:
        install_url: https://releases.nixos.org/nix/nix-2.8.0/install
        extra_nix_config: |
          experimental-features = nix-command flakes
          auto-optimise-store = true
          extra-substituters = https://nix-community.cachix.org
          extra-trusted-public-keys = nix-community.cachix.org-1:mB9FSh9qf2dCimDSUo8Zy7bkq5CX+/rkCWyvRCYg3Fs=
    - run: nix flake update
      name: Update flake
    - name: Upload lockfile
      uses: actions/upload-artifact@v3
      with:
        name: flake_lock
        path: flake.lock
